---
title: Customize your docx conversion
meta:
    title: Image handling | Tiptap Conversion
    description: Preserve images in your converted documents by providing an image upload callback url.
    category: Conversion
---

This document provides comprehensive documentation for the DOCX to Tiptap JSON conversion service and the Tiptap JSON to DOCX conversion service.

## Supported Features

This conversion is not a one-to-one mapping between Tiptap and DOCX formats.

Tiptap relies on CSS for styling elements, which cannot be directly ported to DOCX documents.

The conversion process uses standardized DOCX styling that approximates the default visual appearance of a regular Word Document but may not exactly match every single style.

You can customize the DOCX output styling to better match your needs, but you should be aware of these inherent limitations when planning your conversion workflow.

The conversion service currently supports the following DOCX features:

- **Text Content**

- Basic text conversion with preserved whitespace
- Punctuation handling
- Smart text spacing between nodes

- **Text Formatting**

- Bold text
- Italic text
- Underline
- Strikethrough
- Text alignment (left, center, right, justify)
- Line height

- **Block Elements**

- Paragraphs
- Headings (levels 1-6)
- Blockquotes
- Lists (ordered and unordered)

- **Tables**

- Basic table structure
- Header rows
- Cell spanning (colspan)

- **Links**

- Hyperlinks with target attributes
- Relationship resolution from DOCX structure

- **Media**

- Embedded images
- Image size preservation

- **Styles**

- Paragraph styles mapping
- Canonical style resolution

## Limitations

The following features are currently not supported or have limitations:

- Comments and revisions
- Table of contents
- Footnotes and endnotes
- Document sections and page breaks
- Advanced formatting (columns, text direction)
- Form elements
- Macros and embedded code
- Document metadata
- Headers and footers
- Watermarks
- Text boxes and shapes
- Math equations
- Charts and graphs
- SmartArt

## Usage Example

### Basic Conversion

```typescript
const editor = useEditor({
  extensions: [
    StarterKit,
    Image.configure({
      inline: true,
    }),
    Placeholder.configure({
      placeholder: 'Write something...',
    }),
    Highlight.configure({ multicolor: true }),
    TextStyleKit.configure({ mergeNestedSpanStyles: true }),
    TableKit,
    ExportDocx, // Export Doc Extension
  ],
  content: mockContent,
})

// Call the `exportDocx()` command to convert the Tiptap JSON content to DOCX
editor
  .chain()
  .exportDocx(
    result => {
      setIsLoading(false)
      const blob = new Blob([result], {
        type: 'application/vnd.openxmlformats-officedocument.wordprocessingml.document',
      })
      const url = URL.createObjectURL(blob)
      const a = document.createElement('a')
      a.href = url
      a.download = 'export.docx'
      a.click()
      URL.revokeObjectURL(url)
    },
    {
      exportType: 'blob',
    },
  )
  .run()
```

### Development Options

#### Client-side vs Server-side Export

The `ExportDocx` extension can be used in two ways:

1. **Client-side Usage**:

- Requires bundling `docxjs` with your application
- Import using: `import { ExportDocx } from '@tiptap-pro/extension-export-docx'`
- All document generation happens in the browser
- Suitable for applications where you want to reduce server load

2. **Server-side Usage**:
- Import using: `import { convert } from '@tiptap-pro/extension-export-docx'`
- Document generation happens on your server
- Suitable for applications with complex documents or where you want to reduce client-side bundle
size

> **NOTE:** Feature support is identical between import and export services. All features documented
> in the "Supported Features" section are available in both direction conversions.

#### Server-side Export Example

```typescript
import { convert } from '@tiptap-pro/extension-export-docx'
import express from 'express'

const app = express()
app.post('/export-docx', async (req, res) => {
  try {
    // Get Tiptap JSON content from request
    const { content } = req.body

    // Convert to DOCX
    const docxBuffer = await convert(content)

    // Send as downloadable file
    res.setHeader('Content-Type', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document')
    res.setHeader('Content-Disposition', 'attachment; filename="document.docx"')
    res.send(docxBuffer)
  } catch (error) {
    res.status(500).json({ error: error.message })
  }
})
```

### React Component with Import/Export Functionality

The following example demonstrates a React component that implements both DOCX import and export
functionality using Tiptap Pro extensions:

```jsx
import React, { useCallback, useRef, useState } from 'react'
import { EditorContent, useEditor } from '@tiptap/react'
import StarterKit from '@tiptap/starter-kit'
import { Image } from '@tiptap/extension-image'
import Placeholder from '@tiptap/extension-placeholder'
import Highlight from '@tiptap/extension-highlight'
import { TextStyleKit } from '@tiptap/extension-text-style'
import { TableKit } from '@tiptap/extension-table'

// Import the DOCX-related extensions
import { ExportDocx } from '@tiptap-pro/extension-export-docx'
import Import from '@tiptap-pro/extension-import'

const DocumentEditor = () => {
  const importRef = useRef(null)
  const [isLoading, setIsLoading] = useState(false)
  const [error, setError] = useState(null)

  const editor = useEditor({
    extensions: [
      StarterKit,
      Image.configure({ inline: true }),
      Placeholder.configure({ placeholder: 'Write something...' }),
      // Configure the DOCX export extension
      ExportDocx,
      Highlight.configure({ multicolor: true }),
      TextStyleKit.configure({ mergeNestedSpanStyles: true }),
      // Configure the import extension with DOCX support
      Import.configure({
        appId: 'your-app-id',
        token: 'your-jwt',
        endpoint: 'https://your-conversion-api-endpoint.com',
        imageUploadCallbackUrl: 'https://your-image-upload-endpoint.com',
        experimentalDocxImport: true, // Enable DOCX import
      }),
      TableKit,
    ],
    content: '<!-- Your initial content -->',
  })

  // Export document to DOCX
  const handleExportDocx = useCallback(() => {
    if (!editor) return

    setIsLoading(true)

    editor
      .chain()
      .exportDocx(
        result => {
          setIsLoading(false)
          // Create a download link for the DOCX file
          const blob = new Blob([result], {
            type: 'application/vnd.openxmlformats-officedocument.wordprocessingml.document',
          })
          const url = URL.createObjectURL(blob)
          const a = document.createElement('a')
          a.href = url
          a.download = 'export.docx'
          a.click()
          URL.revokeObjectURL(url)
        },
        {
          exportType: 'blob', // Get result as a binary blob
        },
      )
      .run()
  }, [editor])

  // Handle file selection for import
  const handleImportClick = useCallback(() => {
    importRef.current.click()
  }, [])

  // Process the selected file for import
  const handleImportFilePick = useCallback(
    e => {
      const file = e.target.files[0]
      importRef.current.value = ''

      if (!file) return

      setIsLoading(true)
      setError(null)

      editor
        .chain()
        .import({
          file,
          onImport(context) {
            if (context.error) {
              setError(context.error)
              setIsLoading(false)
              return
            }
            context.setEditorContent(context.content)
            setError(null)
            setIsLoading(false)
          },
          format: 'docx', // Specify DOCX format for import
        })
        .run()
    },
    [editor],
  )

  if (!editor) return null

  return (
    <div>
      <div className="toolbar">
        <button disabled={editor.isEmpty} onClick={handleExportDocx}>
          Export to DOCX
        </button>
        {/* Other editor controls */}
        <button onClick={handleImportClick}>
          Import DOCX
          <input
            onChange={handleImportFilePick}
            type="file"
            ref={importRef}
            style={{ display: 'none' }}
            accept=".docx"
          />
        </button>
      </div>

      {isLoading && <div>Processing...</div>}
      {error && <div className="error">{error.message}</div>}

      <EditorContent editor={editor} />
    </div>
  )
}

export default DocumentEditor
```

#### Export Process

When exporting to DOCX:

1. The `exportDocx` command serializes the Tiptap content to a compatible format
2. It converts Tiptap nodes to DOCX XML structure
3. Generates a binary DOCX file with proper formatting
4. Returns the result as a blob for download

Whether using client-side or server-side export, the resulting DOCX document will maintain
consistent formatting and features.

#### Custom Node Support for Export

> **IMPORTANT NOTE:** The ExportDocx extension supports custom nodes when used client-side or on
> your own servers, but custom node converters must follow strict requirements:
>
> 1. Custom node converters must return one of the following types from the `docx` library:
>
>    - `Paragraph`
>    - `Paragraph[]` (array of paragraphs)
>    - `Table`
>    - `null`
>
> 2. The returned objects must strictly adhere to the `docx` library's specifications
>
> 3. Failure to meet these requirements will cause the conversion process to fail
>
> Example custom node converter:
>

```typescript
editor
  .chain()
  .exportDocx(
    result => {
      setIsLoading(false)
      const blob = new Blob([result], {
        type: 'application/vnd.openxmlformats-officedocument.wordprocessingml.document',
      })
      const url = URL.createObjectURL(blob)
      const a = document.createElement('a')
      a.href = url
      a.download = 'export.docx'
      a.click()
      URL.revokeObjectURL(url)
    },
    {
      exportType: 'blob',
    },
    [
      {
        type: 'hint-box',
        render: () => {
          return new Paragraph({
            children: [
              new TextRun({
                bold: true,
                text: 'Heads-up!',
                allCaps: true,
              }),
              new TextRun({
                text: 'This is an important information message!',
                break: 1,
              }),
            ],
            shading: {
              color: '60945d',
              type: 'solid',
            },
            indent: {
              firstLine: 480,
            },
            border: {
              top: {
                style: 'single',
                size: 1,
                color: '00FF00',
              },
              bottom: {
                style: 'single',
                size: 1,
                color: '00FF00',
              },
              left: {
                style: 'single',
                size: 1,
                color: '00FF00',
              },
              right: {
                style: 'single',
                size: 1,
                color: '00FF00',
              },
            },
          })
        },
      },
    ],
  )
  .run()
```

#### Import Process

When importing a DOCX file:

1. The file is sent to the conversion service configured in the Import extension
2. The service parses the DOCX using the methods described in this documentation
3. The parsed content is converted to Tiptap JSON
4. The callback sets the converted content in the editor

## Conversion Process

1. **DOCX Parsing**: The DOCX file (essentially a ZIP archive) is extracted and its XML content is
parsed
2. **Relationship Resolution**: Links to external resources and embedded media are resolved
3. **Style Mapping**: DOCX styles are mapped to appropriate Tiptap structures
4. **Node Conversion**: Each DOCX element is converted to the corresponding Tiptap node
5. **Text Processing**: Text runs are processed with appropriate marks and spacing
6. **Media Embedding**: Images are embedded as base64 data URIs
7. **JSON Construction**: The complete Tiptap-compatible JSON structure is built

## Best Practices

1. **Large Documents**: For large documents, consider implementing a streaming or chunked conversion
process
2. **Images**: Be aware that embedding large images as base64 can significantly increase the JSON
size
3. **Error Handling**: Implement robust error handling for unsupported DOCX features
4. **Style Customization**: Provide a way for users to customize the style mapping
5. **Performance**: Monitor memory usage when converting large documents with many images

## Extending the Converter

To add support for additional DOCX features:

1. Identify the XML structure of the feature in the DOCX format
2. Create appropriate Tiptap node/mark types if they don't exist
3. Implement a conversion function for the new feature
4. Update the main conversion process to use the new function
5. Add tests to verify the conversion works correctly
6. Update this documentation to reflect the new capability